# 監視・アラート設計

本ドキュメントは、決済フローに必要な最低限の監視項目を定義する。

## 監視の目的
- 決済失敗やWebhook異常を早期検知する
- API遅延や外部障害を把握する
- 寄付体験の品質を担保する

## メトリクス（SLI候補）

| 指標 | 説明 | 目標値（初期） |
|------|------|----------------|
| Webhook成功率 | 2xx比率 | 99%以上 |
| 署名検証成功率 | 署名OK比率 | 99%以上 |
| 決済成功率 | completed / total | 95%以上 |
| APIレイテンシ | p95 | 1.0s以内 |
| 5xx率 | サーバーエラー比率 | 1%未満 |

## アラート条件（初期案）
- Webhook 5xx が10分間で5件以上
- 署名検証失敗率が5分で5%以上
- 決済成功率が直近1時間で90%未満
- 外部APIタイムアウトが5分で3回以上

## ダッシュボード項目
- APIレイテンシ（p50/p95）
- Webhook受信件数と失敗件数
- 決済成功/失敗/返金の件数推移
- プロバイダ別の成功率

## ログ設計
- 重要イベント: `payment.created` / `payment.completed` / `payment.failed`
- 個人情報はマスキング
- 署名検証結果は必ず記録
