# 技術スタック

## 採用技術

### 支援決済
- **PayPay for Developers**
  - 決済API連携（注文作成、決済ステータス取得、Webhook）
  - 署名検証とIP制限の対応が必須
- **楽天ペイ（オンライン決済）**
  - 決済API連携（注文作成、ステータス更新、Webhook）
  - 仕様の差分吸収が必要（API仕様の違いをアダプタで吸収）

### アプリケーション基盤
- **Cloud Run**
  - 決済セッション作成、Webhook受信、支援完了ページ制御
- **Cloud Firestore**
  - 支援履歴、決済ステータス、流入元の保存
- **Secret Manager**
  - APIキー/署名鍵の管理とローテーション
- **Cloud NAT**
  - 決済プロバイダ向けの固定IP通信

### Webサイト
- **既存HP**（タダカヨ公式サイト）
  - 支援案内ページを追加
  - Cloud Runの支援エントリへリンク

### アクセス解析
- **Google Analytics 4**
  - 流入元（QR種類）のトラッキング
  - URLパラメータ（?source=xxx）で識別

### 監視・ログ
- **Cloud Logging / Monitoring**
  - Webhook失敗率や決済成功率の監視
  - 異常検知のアラート通知

### QRコード
- 無料のQRコード生成ツールを使用
  - 例: QRコード作成サイト、Googleスプレッドシートのアドオン等

## 将来の拡張オプション

支援規模が拡大した場合、以下への移行を検討：

| ツール | 用途 | 移行タイミング |
|--------|------|---------------|
| コングラント | 領収書自動発行、支援者CRM | 年間支援50万円超 |
| 独自フロント | 決済UX最適化 | 金額/支援頻度の最適化が必要な場合 |

## 採用しなかった技術

調査の結果、以下は現時点で不採用：

| 技術/サービス | 当初の想定 | 不採用理由 |
|--------------|-----------|-----------|
| つながる募金 | 寄付プラットフォーム | 新規受付停止の報告があるため |
| 独自決済ゲートウェイ | 決済集約 | 初期フェーズで過剰 |

## コスト

| 項目 | 月額 |
|------|------|
| Cloud Run / Firestore | 利用量に応じて変動 |
| Secret Manager | 低額（シークレット数に応じて変動） |
| Cloud NAT | 固定IPの基本料金 + 通信量 |
| 決済手数料 | 契約条件により変動 |
| Google Analytics 4 | 0円 |
| QRコード生成 | 0円 |
| **合計** | **GCP従量 + 決済手数料** |
