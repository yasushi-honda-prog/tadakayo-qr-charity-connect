# AI駆動開発ガイド

本プロジェクトはAI支援を前提に、設計・実装・検証を高速化します。以下をルール化して品質と安全性を担保します。

## 基本方針
- 変更は必ずドキュメントと同期（ADR/ロードマップ/運用）
- 仕様変更は「目的」「範囲」「受け入れ条件」を先に記述
- セキュリティと決済の挙動は人が最終レビュー

## ワークフロー（推奨）
1. 課題定義: 目的・スコープ・成功条件・リスクを明文化
2. 設計: 影響範囲の調査とADR更新
3. 実装: 小さくコミットし、変更単位を明確化
4. 検証: テスト・ログ・手動フローで支払い通知まで確認
5. ドキュメント更新: 仕様、ADR、運用の差分を反映

## AIへの依頼テンプレート
- 仕様整理: 「目的」「制約」「非機能要件」「想定リスク」を含める
- 実装支援: 対象ファイル、受け入れ条件、禁止事項を明記
- レビュー: 失敗モード、セキュリティ、ログ漏洩観点で確認

## 品質ゲート（Definition of Done）
- ユースケースが再現可能なテストまたは手順がある
- Webhookの署名検証が実装・テストされている
- 依存関係と環境変数が`docs/`に反映されている
- 監視とアラートの要件が`docs/operations.md`に反映されている

## セキュリティと秘匿情報
- シークレットは必ずSecret Managerを使用
- APIキーや署名鍵をログに出力しない
- 決済関連のログはPIIマスキングルールを定義

## AI利用時の注意
- 外部の実在ユーザー情報を入力しない
- 設計判断はADRに記録し、再現性を確保
- 生成コードは必ず決済フローと異常系を重点確認
