# テスト計画

本ドキュメントは、決済フローの最小テスト方針を定義する。

## 単体テスト
- 署名検証ロジック
- idempotency判定
- ステータス遷移（pending -> completed/failed/refunded/expired）
- 例外処理（不正ペイロード/タイムアウト）

## 結合テスト
- 決済セッション作成 API の入力検証
- Webhook受信からFirestore更新までの一連処理
- 既処理イベントの重複排除

## E2Eテスト（手動）
1. QRコードから寄付ページへ遷移
2. 金額選択
3. PayPay/楽天ペイの決済画面に遷移
4. 決済完了
5. サンクスページ表示
6. Firestoreに記録が残ること

## 失敗パス
- 署名不一致でWebhookが拒否される
- Webhookが重複送信されても二重記録されない
- 外部APIタイムアウト時に適切なエラーを返す

## テストデータ方針
- 実在の個人情報は使用しない
- 金額はテスト許容範囲内に制限
